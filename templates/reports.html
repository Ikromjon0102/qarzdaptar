{% extends 'base.html' %}
{% load custom_filters %}

{% block matn %}
    <h3 class="fw-bold m-0"><i class="fa-solid fa-calendar-days"></i> Oylik Hisobot</h3>
{% endblock %}

{% block content %}

<form method="get" class="mb-4">
    <div class="bg-white border rounded-3 border-primary border-opacity-10">
        <div class="card-body p-2 d-flex gap-2 align-items-center">
            <input type="month" name="date" value="{{ selected_date }}" 
                   class="form-control fw-bold text-center" 
                   onchange="this.form.submit()"> <button class="btn btn-primary"><i class="fa-solid fa-filter"></i></button>
        </div>
    </div>
</form>

<h6 class="text-muted small text-uppercase fw-bold mb-2 ps-1 text-dark">ðŸ“Š {{ month }}-oy uchun natijalar</h6>

<div class="row g-2 mb-3">
    <div class="col-6">
        <div class="p-3 bg-white rounded-3 shadow-sm border border-primary border-opacity-10 text-center h-100">
            <small class="d-block " style="font-size: 0.7rem;">Nasiyaga sotildi</small>
            <h6 class="fw-bold mb-0 mt-1 text-dark">{{ stats.sales_uzs|space_format }}</h6>
            <small class="text-muted text-dark" style="font-size: 0.7rem;">${{ stats.sales_usd|space_format }}</small>
        </div>
    </div>

    <div class="col-6">
        <div class="p-3 bg-white rounded-3 shadow-sm border border-success border-opacity-25 text-center h-100 bg-success bg-opacity-10">
            <small class="d-block text-success" style="font-size: 0.7rem;">Undirildi</small>
            <h6 class="fw-bold text-success mb-0 mt-1">+{{ stats.income_uzs|space_format }}</h6>
            <small class="text-success" style="font-size: 0.7rem;">+${{ stats.income_usd|space_format }}</small>
        </div>
    </div>

    <div class="col-12">
        <div class="p-3 bg-white rounded-3 shadow-sm border text-center">
            <small class="">Sof Natija (Saldo)</small>
            <div class="d-flex justify-content-between px-4 mt-2">
                <span class="fw-bold {% if stats.diff_uzs > 0 %}text-danger{% else %}text-success{% endif %}">
                    {{ stats.diff_uzs|space_format }} so'm
                </span>
                <span class="fw-bold {% if stats.diff_usd > 0 %}text-danger{% else %}text-success{% endif %}">
                    ${{ stats.diff_usd|space_format }}
                </span>
            </div>
        </div>
    </div>
<hr class="text-muted opacity-25">

<div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="text-muted small text-uppercase fw-bold m-0 ps-1 text-dark">ðŸ‘¥ Shu oydagi faollar</h6>
    <span class="badge  text-dark border">{{ active_clients|length }} ta</span>
</div>

<div class="pb-5">
    {% for client in active_clients %}
    <div class="col-12 mb-2">
        <div class="p-3 bg-white rounded-3 shadow-sm border border-opacity-10 d-flex justify-content-between align-items-center"
             onclick="location.href='{% url 'admin_client_detail' client.id %}'" style="cursor: pointer;">

            <div>
                <h6 class="fw-bold mb-0 text-dark">{{ client.full_name }}</h6>
                <small class="text-muted" style="font-size: 0.7rem;">{{ client.phone }}</small>
            </div>

            <div class="text-end" style="font-size: 0.8rem;">

                {% if client.debt_uzs > 0 or client.debt_usd > 0 %}
                    <div class="mb-1 border-bottom pb-1">
                        {% if client.debt_uzs > 0 %}
                            <div class="text-danger fw-bold">
                                <i class="fa-solid fa-arrow-up small"></i> {{ client.debt_uzs|space_format }} so'm
                            </div>
                        {% endif %}
                        {% if client.debt_usd > 0 %}
                            <div class="text-danger fw-bold">
                                <i class="fa-solid fa-arrow-up small"></i> ${{ client.debt_usd|space_format }}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

                {% if client.pay_uzs or client.pay_usd %}
                    <div class="mt-1">
                        {% if client.pay_uzs %}
                            <div class="text-success fw-bold">
                                <i class="fa-solid fa-arrow-down small"></i> {{ client.pay_uzs|stringformat:"i"|cut:"-"|space_format }} so'm
                            </div>
                        {% endif %}
                        {% if client.pay_usd %}
                            <div class="text-success fw-bold">
                                <i class="fa-solid fa-arrow-down small"></i> ${{ client.pay_usd|stringformat:"i"|cut:"-"|space_format }}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

            </div>

        </div>
    </div>
    {% empty %}
    <div class="text-center py-4 text-muted">
        <i class="fa-regular fa-calendar-xmark fa-2x mb-2 opacity-25"></i>
        <p class="small text-dark">Bu oyda hech qanday harakat bo'lmadi.</p>
    </div>
    {% endfor %}
</div>
</div>

{% endblock %}